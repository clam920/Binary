<!-- Bootsrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
        // import data from "./assets/type.json" assert { type: 'json' };
        var facilities = [];
        const data = [
                {
                        "type": "glass",
                        "facility": [
                                {
                                        "place": "NORTH SHORE RECYCLING AND WASTE CENTRE",
                                        "coordinates": [-123.01809661781101, 49.30128946964686]
                                },
                                {
                                        "place": "POWELL STREET RETURN-IT BOTTLE DEPOT",
                                        "coordinates": [-123.06668623130273, 49.28432306230311]
                                }
                        ]
                },
                {
                        "type": "plastic",
                        "facility": [
                                {
                                        "coordinates": [-122.46152803131277, 9.090931848515034],
                                        "place": "BLUE PLANET RECYCLING",
                                },
                                {
                                        "coordinates": [-122.81127270247502, 49.118203173139264],
                                        "place": "EMTERRA ENVIRONMENTAL - SURREY",
                                },
                                {
                                        "coordinates": [-123.10084884294041, 49.25716962771798],
                                        "place": "URBAN SOURCE",
                                },
                                {
                                        "coordinates": [-122.62682891358655, 49.20014503465938],
                                        "place": "WESTCOAST PLASTIC RECYCLING",
                                }
                        ]
                },
                {
                        "type": "cardboard",
                        "facility": [
                                {
                                        "coordinates": [-123.06668623130273, 49.28432306230311],
                                        "place": "POWELL STREET RETURN-IT BOTTLE DEPOT",
                                },
                                {
                                        "coordinates": [-123.09190007177935, 49.20640098139237],
                                        "place": "BEGG CARTON EXCHANGE",
                                }
                        ]
                },
                {
                        "type": "paper",
                        "facility": [
                                {
                                        "coordinates": [-123.06668623130273, 49.28432306230311],
                                        "place": "POWELL STREET RETURN-IT BOTTLE DEPOT",
                                },
                                {
                                        "coordinates": [-123.10642038874201, 49.20894031159841],
                                        "place": "SOUTH VAN BOTTLE DEPOT",
                                },
                                {
                                        "coordinates": [-123.1149743134225, 49.20867115835692],
                                        "place": "VANCOUVER ZERO WASTE CENTER",
                                },
                        ]
                },
                {
                        "type": "paper",
                        "facility": [
                                {
                                        "coordinates": [-123.06668623130273, 49.28432306230311],
                                        "place": "POWELL STREET RETURN-IT BOTTLE DEPOT",
                                },
                                {
                                        "coordinates": [-123.10642038874201, 49.20894031159841],
                                        "place": "SOUTH VAN BOTTLE DEPOT",
                                },
                                {
                                        "coordinates": [-123.1149743134225, 49.20867115835692],
                                        "place": "VANCOUVER ZERO WASTE CENTER",
                                },
                        ]
                },
                {
                        "type": "metal",
                        "facility": [
                                {
                                        "coordinates": [-123.08198097141488, 49.27338112280383],
                                        "place": "REGIONAL RECYCLING - VANCOUVER",
                                },
                                {
                                        "coordinates": [-122.57650130520572, 49.20857510585476],
                                        "place": "WESTERN DRUM RECYCLERS",
                                },
                        ]
                }
        ]

        const getSelected2 = () => {
                var selection = document.getElementById("auto-suggest").value;
                // console.log(selection);
                if (facilities.length > 0) {
                        facilities.splice(0, facilities.length);
                }
                data.forEach(el => {
                        if (el.type === selection) {
                                facilities = el.facility;
                        }
                });

                removeMarkers();

                document.getElementById("infoCard").innerHTML = "";

                // add markers to map
                for (const feature of facilities) {
                        // console.log(feature)
                        // create a HTML element for each feature
                        const el = document.createElement('div');
                        el.className = 'marker';
                        const popup = new mapboxgl.Popup({ offset: 25 }).setHTML(feature.place + "\n\n" + `<a href="${feature.directions}" target="_blank">${feature.directions}</a>`);

                        // make a marker for each feature and add to the map
                        new mapboxgl.Marker(el).setLngLat(feature.coordinates).addTo(map).setPopup(popup);

                        // info card for features
                        const elCard = document.createElement('div');
                        elCard.className = 'card';
                        elCard.style = 'width: 18rem;';
                        elCard.innerHTML = `<div class="card-body">
        <h5 class="card-title">${feature.place}</h5>
        <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>
        <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        <a href="#" class="card-link">Card link</a>
        <a href="#" class="card-link">Another link</a>
    </div>`;

                        document.getElementById("infoCard").appendChild(elCard);

                }
        }
        function removeMarkers() {
                const markers = document.getElementsByClassName('marker');
                while (markers.length > 0) {
                        markers[0].parentNode.removeChild(markers[0]);
                }
        }

        document.addEventListener('DOMContentLoaded', () => {
                const input = document.getElementById('auto-suggest');
                const suggestionsBox = document.getElementById('suggestions');

                let suggestions = [];

                // Fetch suggestions from the JSON file
                fetch('../type.json')
                        .then(response => response.json())
                        .then(data => {
                                suggestions = data;
                        })
                        .catch(error => console.error('Error fetching suggestions:', error));

                // Show suggestions based on user input
                input.addEventListener('input', () => {
                        const query = input.value.toLowerCase();
                        suggestionsBox.innerHTML = '';
                        console.log(query);
                        if (query) {
                                const filteredSuggestions = suggestions.filter(item => item.type.toLowerCase().includes(query));

                                filteredSuggestions.forEach(suggestion => {
                                        const suggestionElement = document.createElement('div');
                                        suggestionElement.textContent = suggestion.type;
                                        suggestionElement.addEventListener('click', () => {
                                                input.value = suggestion.type;
                                                suggestionsBox.innerHTML = '';
                                                suggestionsBox.style.display = 'none';
                                        });
                                        console.log(suggestionElement)
                                        suggestionsBox.appendChild(suggestionElement);
                                });

                                suggestionsBox.style.display = 'block';
                        } else {
                                suggestionsBox.style.display = 'none';
                        }
                });

                // Hide suggestions when clicking outside the input or suggestions box
                document.addEventListener('click', (event) => {
                        if (!suggestionsBox.contains(event.target) && event.target !== input) {
                                suggestionsBox.style.display = 'none';
                        }
                });
        });

</script>
</body>

</html>